<div class="container">
  <div class="jumbotron">
    <h1 class="center-title">Listado de usuarios</h1>
      <div class="col-lg-12">
        <a href="/newUser" class="btn btn-success">Crear Usuario</a>
        <h2>Filtrar por:</h2>
        <%= form_tag '/filtered', method: "get", class: "form-inline", id: "filter-form" do %>
          <% if current_user.is_oficial %>
            <div class="form-group">
              <%= select_tag(:campament_id, options_from_collection_for_select(Campament.all, :id, :name), class: "form-control", :prompt => "Seleccionar campamento") %>
            </div>
            <div class="form-group" id="chapterDiv2">
              <%= render :partial => 'chapters2', :object => @chapters ,label: "Capitulo"%>
            </div>
          <% end %>
          <div class="form-group">
            <%= select_tag(:f, options_for_select([['Mayores de 21', 1], ['DeMolay', 2], ['No DeMolay', 3]]), class: "form-control" ,:prompt => "Seleccionar filtro") %>
          </div>
          <div class="form-group">
            <%= select_tag(:o, options_for_select([['Nombre', 1], ['Apellido', 2], ['Fecha de Nac.', 3], ['Estado', 4]]), class: "form-control", :prompt => "Seleccionar filtro") %>
          </div>
            <%= submit_tag "Filtrar", class: "btn btn-primary" %>
        <% end %>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <br><br />
          <div class="table-responsive">
            <table class="table table-bordered table-hover table-striped">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>DeMolay ID</th>
                  <th>Rol</th>
                  <th>CI</th>
                  <th>Correo Electr√≥nico</th>
                  <th>Capitulo</th>
                  <th>Fecha de Nacimiento</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                <% @users.each do |user| %>
                  <tr>
                    <td><a href="/profile/<%= user.id %>"> <%= user.fullName %></a></td>
                    <td><%= user.demolayID %></td>
                    <td><%= user.role %></td>
                    <td><%= user.ci %></td>
                    <td><%= user.email %></td>
                    <% if user.chapter != nil %>
                      <td><%= user.chapter.chapter_name %></td>
                    <% else %>
                      <td>
                        -
                      </td>
                    <% end %>
                    <td><%= user.birth_date %></td>
                    <td><%= user.status %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
  </div>
</div>

<script type="text/javascript">

  $( "#campament_id" ).change(function() {
    var campament = $("#campament_id").val();
    jQuery.ajax({
      url: "/update_chapters_for_filter",
      type: "GET",
      data: {"campament" : campament},
      dataType: "html",
      success: function(data) {
        jQuery('#chapterDiv2').html(data);
      }
    });
  });



</script>
